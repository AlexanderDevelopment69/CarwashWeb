<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Inicio</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>


<style>
    .card{
        transition: all 0.3s;

    }
    .card:hover{
        transform: scale(1.05);
        background-color: #212529;
        color: white;

    }

    .star {
        color: gray; /* Color de estrella inactiva */
    }

    .star.active {
        color: yellow; /* Color de estrella activa */
    }

</style>
<body>

<div th:replace="~{header :: header}"></div>


<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2000" style="max-height: 600px;">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
        <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="3" aria-label="Slide 4"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img th:src="@{/images/image1.jpg}" class="d-block w-100" alt="Primera imagen" style="max-height: 500px; object-fit: cover;">
            <div class="carousel-caption d-none d-md-block">
                <h5>Registra tu negocio de lavado de autos hoy</h5>
                <p>¡Únete a nuestra plataforma y promociona tus servicios de lavado de autos a una amplia audiencia de clientes potenciales!</p>
            </div>
        </div>
        <div class="carousel-item">
            <img th:src="@{/images/image2.jpg}" class="d-block w-100" alt="Segunda imagen" style="max-height: 500px; object-fit: cover;">
            <div class="carousel-caption d-none d-md-block">
                <h5>Ofrece servicios de lavado de autos de calidad</h5>
                <p>Destácate ofreciendo servicios de lavado de autos de alta calidad con la comodidad de nuestro sitio web fácil de usar.</p>
            </div>
        </div>
        <div class="carousel-item">
            <img th:src="@{/images/image3.jpg}" class="d-block w-100" alt="Tercera imagen" style="max-height: 500px; object-fit: cover;">
            <div class="carousel-caption d-none d-md-block">
                <h5>Maximiza tu potencial de ingresos</h5>
                <p>Con nuestra plataforma, podrás llegar a más clientes y aumentar tus ingresos al ofrecer tus servicios de lavado de autos.</p>
            </div>
        </div>
        <div class="carousel-item">
            <img th:src="@{/images/image4.jpg}" class="d-block w-100" alt="Cuarta imagen" style="max-height: 500px; object-fit: cover;">
            <div class="carousel-caption d-none d-md-block">
                <h5>Ofrece servicios de lavado de autos de calidad</h5>
                <p>Destácate ofreciendo servicios de lavado de autos de alta calidad con la comodidad de nuestro sitio web fácil de usar.</p>
            </div>
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>




<!-- Sección de Banner o Presentación -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h2 class="text-center">¡Encuentra el mejor carwash cerca de ti!</h2>
                <p class="lead text-center">Explora los negocios de carwash registrados en nuestra plataforma.</p>
            </div>
        </div>
    </div>
</section>



<section class="py-5">
    <div class="container">
        <!-- Agrega el título de la sección -->
        <div class="row">
            <div class="col-12">
                <h2 class="text-center font-weight-bold">Nuestros socios</h2>
                <p class="text-center">Descubre los negocios de carwash que confían en nosotros</p>
            </div>
        </div>
        <div class="row mt-4">
            <!-- Iterar sobre la lista de partnerDTOs y mostrarlos en tarjetas -->
            <div class="col-md-4" th:each="partner : ${partners}">
                <div class="card mb-3">
                    <!-- Mostrar detalles del socio -->
                    <img th:if="${partner.base64Image != null}"
                         class="card-img-top"
                         th:src="'data:image/jpeg;base64,' + ${partner.base64Image}"
                         th:alt="${partner.name}"
                         style="height: 200px;">
                    <div class="card-body">
                        <h4 class="card-title text-center font-weight-bold" th:text="${partner.name}"></h4>
                        <p class="card-title text-center " th:text="${partner.description}"></p>
                        <h6 class="card-subtitle mb-2 font-weight-bold">Teléfono:</h6>
                        <p class="card-text" th:text="${partner.phoneNumber}"></p>
                        <h6 class="card-subtitle mb-2 font-weight-bold">Dirección:</h6>
                        <p class="card-text" th:text="${partner.address}"></p>
<!--                        <h6 class="card-subtitle mb-2 font-weight-bold">Calificacion:</h6>-->
<!--                        <p class="card-text" th:text="${partner.rating}"></p>-->
                        <h6 class="card-subtitle mb-2 font-weight-bold">Calificación:</h6>
                        <div class="rating mb-3">
                          <span th:each="star : ${#numbers.sequence(1,10)}"
                                class="star"
                                th:classappend="${star <= partner.rating} ? 'active' : ''">
                            &#9733;
                          </span>
                        </div>


                        <button type="button" class="btn btn-outline-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#partnerModal"
                                th:attr="data-id=${partner.id},
                                         data-name=${partner.name},
                                         data-description=${partner.description},
                                         data-phone=${partner.phoneNumber},
                                         data-address=${partner.address},
                                         data-image=${partner.base64Image},
                                         data-rating=${partner.rating},
                                         data-services=${partner.services}">
                            Ver detalles
                        </button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal -->
<div class="modal fade" id="partnerModal" tabindex="-1" aria-labelledby="partnerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="partnerModalLabel">Detalles del Socio</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div class="card">
                    <div class="row g-0">
                        <div class="col-md-5">
                            <img id="partnerImage" class="img-fluid rounded-start" alt="Imagen del Socio" style="height: 100%;">
                        </div>
                        <div class="col-md-7">
                            <div class="card-body">
                                <h4 class="card-title pb-4" id="partnerName"></h4>
                                <h6 class="card-subtitle mb-2 ">Descripción:</h6>
                                <p class="card-text"><span id="partnerDescription"></span></p>
                                <h6 class="card-subtitle mb-2 ">Teléfono:</h6>
                                <p class="card-text"><span id="partnerPhone"></span></p>
                                <h6 class="card-subtitle mb-2 ">Dirección:</h6>
                                <p class="card-text"><span id="partnerAddress"></span></p>

                                <h6 class="card-subtitle mb-2 ">Calificación:</h6>
                                <div class="rating mb-3" id="partnerRating">
                                    <!-- Las estrellas de calificación se generarán dinámicamente aquí -->
                                </div>



                                <h6 class="card-subtitle mb-2 ">Servicios:</h6>
                                <ul class="list-group list-group-flush" id="partnerServices"></ul>
                                <!-- <p><strong>Estado:</strong> <span id="partnerActive"></span></p> -->
                                <button class="btn btn-outline-success mt-3">Contactar</button>
<!--                                <button type="button" class="btn btn-outline-success mt-3" >-->
<!--                                    <a th:href="@{'/reservation/' + ${ id }}">Reservar</a>-->
<!--                                </button>-->

                                <button class="btn btn-outline-primary mt-3" id="reserveButton" >
                                    Reservar
                                </button>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>






<!-- Sección de CTA (Call to Action) -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <h2>¿Tienes un carwash? ¡Regístralo ahora!</h2>
                <p>Únete a nuestra plataforma y llega a más clientes.</p>
                <a href="/register" class="btn btn-primary">Regístrate</a>
            </div>
        </div>
    </div>
</section>



<div th:replace="~{footer :: footer}"></div>

<!-- Bootstrap Bundle (Bootstrap 5) JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


<script>
    var partnerModal = document.getElementById('partnerModal');
    partnerModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Botón que activó el modal
        var id = button.getAttribute('data-id');
        // Aquí puedes hacer lo que necesites con el ID
        console.log('ID del partner:', id);
        var name = button.getAttribute('data-name');
        var description = button.getAttribute('data-description');
        var phone = button.getAttribute('data-phone');
        var address = button.getAttribute('data-address');
        var image = button.getAttribute('data-image');
        var rating = button.getAttribute('data-rating')
        // var active = button.getAttribute('data-active') === 'true' ? 'Activo' : 'Inactivo';
        var dataServices = button.getAttribute('data-services');
        // Remplaza los paréntesis y las comas con comillas dobles y comas según sea necesario
        var jsonData = dataServices.replace(/PartnerTypeCatalogDTO\(id=(\d+), serviceName=(.*?), price=(.*?)\)/g, '{"id":$1,"serviceName":"$2","price":$3}');

        // Analiza la cadena como JSON
        var services = JSON.parse(jsonData);

        // console.log(services);



        // Actualiza el contenido del modal
        var modalTitle = partnerModal.querySelector('.modal-title');
        var modalBodyName = partnerModal.querySelector('#partnerName');
        var modalBodyDescription = partnerModal.querySelector('#partnerDescription');
        var modalBodyPhone = partnerModal.querySelector('#partnerPhone');
        var modalBodyAddress = partnerModal.querySelector('#partnerAddress');
        var modalBodyImage = partnerModal.querySelector('#partnerImage');
        var modalBodyRating= partnerModal.querySelector('#partnerRating');
        // var modalBodyActive = partnerModal.querySelector('#partnerActive');
        var modalBodyServices = partnerModal.querySelector('#partnerServices');

        modalTitle.textContent = 'Detalles'
        modalBodyName.textContent = name;
        modalBodyDescription.textContent = description;
        modalBodyPhone.textContent = phone;
        modalBodyAddress.textContent = address;
        // modalBodyActive.textContent = active;
        if (image) {
            modalBodyImage.src = 'data:image/jpeg;base64,' + image;
        } else {
            modalBodyImage.src = '';
        }


        // Llena la calificación del socio
        var ratingHTML = '<div class="rating mb-3">';
        for (var i = 1; i <= 10; i++) {
            ratingHTML += '<span class="star' + (i <= rating ? ' active' : '') + '">&#9733;</span>';
        }
        ratingHTML += '</div>';
        modalBodyRating.innerHTML = ratingHTML;


        // Actualiza la lista de servicios del socio en el cuerpo del modal
        modalBodyServices.innerHTML = ""; // Limpiar la lista de servicios antes de agregar los nuevos
        // Itera sobre los servicios y agregar cada servicio como un elemento <li> al modal
        services.forEach(function(servicio) {
            // Crea un nuevo elemento <li> con las clases y estilos necesarios
            var listItem = document.createElement('li');
            listItem.className = 'list-group-item';
            listItem.style.backgroundColor = '#212529';
            listItem.style.color = 'white';

            // Crea la estructura de columnas dentro del <li>
            var rowDiv = document.createElement('div');
            rowDiv.className = 'row';

            var nameDiv = document.createElement('div');
            nameDiv.className = 'col';
            nameDiv.innerHTML = '<span>' + servicio.serviceName + '</span>';

            var priceDiv = document.createElement('div');
            priceDiv.className = 'col text-end';
            priceDiv.innerHTML = '<span>' + "S/. "+ servicio.price + '</span>';

            // Agrega las columnas a la fila
            rowDiv.appendChild(nameDiv);
            rowDiv.appendChild(priceDiv);

            // Agrega la fila al <li>
            listItem.appendChild(rowDiv);

            // Agrega el <li> al cuerpo del modal
            modalBodyServices.appendChild(listItem);

        });

    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var partnerModal = document.getElementById('partnerModal');
        var reserveButton = document.getElementById('reserveButton');


        partnerModal.addEventListener('show.bs.modal', function(event) {
            var button = event.relatedTarget; // Botón que activó el modal
            var id = button.getAttribute('data-id');
            // Aquí puedes hacer lo que necesites con el ID
            console.log('ID del partner:', id);

            // Actualizar el atributo "href" del botón "Reservar" con el ID
            reserveButton.setAttribute('data-id', id);
            reserveButton.setAttribute('onclick', "window.location.href='/reservacion/" + id + "'");
        });
    });
</script>



</body>
</html>
